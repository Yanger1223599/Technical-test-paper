<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>電商系統｜商品管理</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    .btn-brand {
      --bs-btn-bg: #0ea5a5;
      --bs-btn-border-color: #0ea5a5;
      color: #fff;
    }

    .btn-brand:hover {
      background-color: #0a8c8c;
      border-color: #0a8c8c;
    }

    .table-wrapper {
      max-height: 500px;
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <div id="app" class="container py-4">

    <!-- 標題 + 登出 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="mb-0">商品管理</h3>
      <button class="btn btn-outline-danger btn-sm" @click="logout">
        <i class="bi bi-box-arrow-right"></i> 登出
      </button>
    </div>

    <!-- 新增商品 -->
    <div class="card mb-4 p-3">
      <h5>新增商品</h5>
      <div class="row g-2">
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="商品名稱" v-model="newProduct.productName">
        </div>
        <div class="col-md-2">
          <input type="number" class="form-control" placeholder="售價" v-model.number="newProduct.price">
        </div>
        <div class="col-md-2">
          <input type="number" class="form-control" placeholder="庫存" v-model.number="newProduct.quantity">
        </div>
        <div class="col-md-2">
          <button class="btn btn-brand w-100" @click="addProduct">新增商品</button>
        </div>
      </div>
    </div>

    <!-- 商品清單 -->
    <div class="card p-3">
      <h5>商品清單</h5>
      <div class="table-wrapper">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>商品編號</th>
              <th>商品名稱</th>
              <th>售價</th>
              <th>庫存</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="product in products" :key="product.productId">
              <td>{{ product.productId }}</td>
              <td>{{ product.productName }}</td>
              <td>{{ product.price }}</td>
              <td>{{ product.quantity }}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary me-1" @click="editProduct(product)">編輯</button>
                <button class="btn btn-sm btn-outline-danger" @click="deleteProduct(product.id)">刪除</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 編輯商品 Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content p-3">
          <h5>編輯商品</h5>
          <div class="mb-2">
            <label>商品編號</label>
            <input class="form-control" v-model="editProductData.productId" disabled>
          </div>
          <div class="mb-2">
            <label>商品名稱</label>
            <input class="form-control" v-model="editProductData.productName">
          </div>
          <div class="mb-2">
            <label>售價</label>
            <input type="number" class="form-control" v-model.number="editProductData.price">
          </div>
          <div class="mb-2">
            <label>庫存</label>
            <input type="number" class="form-control" v-model.number="editProductData.quantity">
          </div>
          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
            <button class="btn btn-brand" @click="updateProduct">儲存</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>

  <script>
    Vue.createApp({
      data() {
        return {
          products: [],
          newProduct: { productName: '', price: 0, quantity: 0 },
          editProductData: {},
          editModal: null
        }
      },
      methods: {
        async fetchProducts() {
          try {
            const res = await fetch('http://localhost:8080/api/product');
            this.products = await res.json();
          } catch (err) {
            alert('無法取得商品列表，請確認後端是否啟動');
          }
        },
        async addProduct() {
          if (!this.newProduct.productName || this.newProduct.price <= 0) {
            alert('請填寫完整商品資訊');
            return;
          }
          try {
            const res = await fetch('http://localhost:8080/api/product', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.newProduct)
            });
            if (!res.ok) {
              alert(await res.text());
              return;
            }
            this.newProduct = { productName: '', price: 0, quantity: 0 };
            this.fetchProducts();
          } catch (err) {
            alert('新增商品失敗');
          }
        },
        editProduct(product) {
          this.editProductData = { ...product };
          this.editModal.show();
        },
        async updateProduct() {
          if (!this.editProductData.productName || this.editProductData.price <= 0) {
            alert('請填寫完整商品資訊');
            return;
          }
          try {
            const res = await fetch(`http://localhost:8080/api/product/${this.editProductData.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.editProductData)
            });
            if (!res.ok) {
              alert(await res.text());
              return;
            }
            this.fetchProducts();
            this.editModal.hide();
          } catch (err) {
            alert('更新商品失敗');
          }
        },
        async deleteProduct(id) {
          if (!confirm('確定刪除該商品嗎？')) return;
          try {
            const res = await fetch(`http://localhost:8080/api/product/${id}`, { method: 'DELETE' });
            if (!res.ok) {
              alert(await res.text());
              return;
            }
            this.fetchProducts();
          } catch (err) {
            alert('刪除商品失敗');
          }
        },
        logout() {
          if (!confirm('確定要登出嗎？')) return;
          localStorage.removeItem('token');
          sessionStorage.clear();
          window.location.href = 'employeelogin.html';
        }
      },
      mounted() {
        this.fetchProducts();
        this.editModal = new bootstrap.Modal(document.getElementById('editModal'));
      }
    }).mount('#app');
  </script>
</body>

</html>

